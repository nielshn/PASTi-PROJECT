{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\nvar _possibleConstructorReturn = require(\"@babel/runtime/helpers/possibleConstructorReturn\");\nvar _getPrototypeOf = require(\"@babel/runtime/helpers/getPrototypeOf\");\nvar _inherits = require(\"@babel/runtime/helpers/inherits\");\nvar _toConsumableArray = require(\"@babel/runtime/helpers/toConsumableArray\");\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nexports.__esModule = true;\nexports[\"default\"] = void 0;\nvar _react = require(\"react\");\nvar isServer = false;\nvar _default = function _default() {\n  var mountedInstances = new Set();\n  var state;\n  function emitChange(component) {\n    state = component.props.reduceComponentsToState(_toConsumableArray(mountedInstances), component.props);\n    if (component.props.handleStateChange) {\n      component.props.handleStateChange(state);\n    }\n  }\n  return /*#__PURE__*/function (_react$Component) {\n    function _class(props) {\n      var _this;\n      _classCallCheck(this, _class);\n      _this = _callSuper(this, _class, [props]);\n      if (isServer) {\n        mountedInstances.add(_this);\n        emitChange(_this);\n      }\n      return _this;\n    }\n    _inherits(_class, _react$Component);\n    return _createClass(_class, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        mountedInstances.add(this);\n        emitChange(this);\n      }\n    }, {\n      key: \"componentDidUpdate\",\n      value: function componentDidUpdate() {\n        emitChange(this);\n      }\n    }, {\n      key: \"componentWillUnmount\",\n      value: function componentWillUnmount() {\n        mountedInstances[\"delete\"](this);\n        emitChange(this);\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        return null;\n      }\n    }], [{\n      key: \"rewind\",\n      value:\n      // Used when server rendering\n      function rewind() {\n        var recordedState = state;\n        state = undefined;\n        mountedInstances.clear();\n        return recordedState;\n      }\n    }]);\n  }(_react.Component);\n};\nexports[\"default\"] = _default;","map":{"version":3,"sources":["../../../next-server/lib/side-effect.tsx"],"names":["isServer","mountedInstances","Set","state","emitChange","component","props","reduceComponentsToState","handleStateChange","Component","recordedState","undefined","clear","constructor","add","componentDidMount","componentDidUpdate","componentWillUnmount","render"],"mappings":";;;;;;;;;;;;AAAA,IAAA,MAAA,GAAA,OAAA,CAAA,OAAA,CAAA;AAEA,IAAMA,QAAQ,QAAd;eAae,S,WAAM;EACnB,IAAMC,gBAA0B,GAAG,IAAIC,GAAJ,CAAA,CAAnC;EACA,IAAIC,KAAJ;EAEA,SAASC,UAAT,CAAoBC,SAApB,EAAuE;IACrEF,KAAK,GAAGE,SAAS,CAACC,KAAVD,CAAgBE,uBAAhBF,CAAAA,kBAAAA,CACFJ,gBADEI,GAENA,SAAS,CAACC,KAFJD,CAARF;IAIA,IAAIE,SAAS,CAACC,KAAVD,CAAgBG,iBAApB,EAAuC;MACrCH,SAAS,CAACC,KAAVD,CAAgBG,iBAAhBH,CAAkCF,KAAlCE,CAAAA;IACD;EACF;EAED,8BAAA,gBAAA;IASEQ,SAAAA,OAAYP,KAAD,EAAa;MAAA,IAAA,KAAA;MAAA,eAAA,OAAA,MAAA;MACtB,KAAA,GAAA,UAAA,OAAA,MAAA,GAAMA,KAAN;MACA,IAAIN,QAAJ,EAAc;QACZC,gBAAgB,CAACa,GAAjBb,CAAAA,KAAAA,CAAAA;QACAG,UAAU,CAAA,KAAA,CAAVA;MACD;MACF,OAAA,KAAA;IAAA;IACDW,SAAAA,CAAAA,MAAAA,EAAAA,gBAAAA;IAAAA,OAAAA,YAAAA,CAAAA,MAAAA;MAAAA,GAAAA;MAAAA,KAAAA,WAAAA,kBAAAA,EAAoB;QAClBd,gBAAgB,CAACa,GAAjBb,CAAqB,IAArBA,CAAAA;QACAG,UAAU,CAAC,IAAD,CAAVA;MACD;IACDY;MAAAA,GAAAA;MAAAA,KAAAA,WAAAA,mBAAAA,EAAqB;QACnBZ,UAAU,CAAC,IAAD,CAAVA;MACD;IACDa;MAAAA,GAAAA;MAAAA,KAAAA,WAAAA,qBAAAA,EAAuB;QACrBhB,gBAAgB,UAAhBA,CAAwB,IAAxBA,CAAAA;QACAG,UAAU,CAAC,IAAD,CAAVA;MACD;IAEDc;MAAAA,GAAAA;MAAAA,KAAAA,WAAAA,OAAAA,EAAS;QACP,OAAO,IAAP;MACD;IA9BH;MAAA,GAAA;MAAA,KAAA;MACE;MACA,SAAA,OAAA,EAAgB;QACd,IAAMR,aAAa,GAAGP,KAAtB;QACAA,KAAK,GAAGQ,SAARR;QACAF,gBAAgB,CAACW,KAAjBX,CAAAA,CAAAA;QACA,OAAOS,aAAP;MACD;IAEDG;EAAAA,EATmBJ,MAAAA,CAAAA,SAA2B;AAgCjD,C","sourcesContent":["import React, { Component } from 'react'\n\nconst isServer = typeof window === 'undefined'\n\ntype State = Array<React.ReactElement<any>> | undefined\n\ntype SideEffectProps = {\n  reduceComponentsToState: <T>(\n    components: Array<React.ReactElement<any>>,\n    props: T\n  ) => State\n  handleStateChange?: (state: State) => void\n  inAmpMode?: boolean\n}\n\nexport default () => {\n  const mountedInstances: Set<any> = new Set()\n  let state: State\n\n  function emitChange(component: React.Component<SideEffectProps>): void {\n    state = component.props.reduceComponentsToState(\n      [...mountedInstances],\n      component.props\n    )\n    if (component.props.handleStateChange) {\n      component.props.handleStateChange(state)\n    }\n  }\n\n  return class extends Component<SideEffectProps> {\n    // Used when server rendering\n    static rewind() {\n      const recordedState = state\n      state = undefined\n      mountedInstances.clear()\n      return recordedState\n    }\n\n    constructor(props: any) {\n      super(props)\n      if (isServer) {\n        mountedInstances.add(this)\n        emitChange(this)\n      }\n    }\n    componentDidMount() {\n      mountedInstances.add(this)\n      emitChange(this)\n    }\n    componentDidUpdate() {\n      emitChange(this)\n    }\n    componentWillUnmount() {\n      mountedInstances.delete(this)\n      emitChange(this)\n    }\n\n    render() {\n      return null\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"script"}