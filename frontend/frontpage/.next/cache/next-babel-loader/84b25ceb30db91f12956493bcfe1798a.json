{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"@babel/runtime/helpers/classCallCheck\");\nvar _createClass = require(\"@babel/runtime/helpers/createClass\");\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nexports.__esModule = true;\nexports[\"default\"] = void 0;\nvar _url = require(\"url\");\nvar _mitt = _interopRequireDefault(require(\"../next-server/lib/mitt\"));\nvar _isDynamic = require(\"./../next-server/lib/router/utils/is-dynamic\");\nvar _routeMatcher = require(\"./../next-server/lib/router/utils/route-matcher\");\nvar _routeRegex = require(\"./../next-server/lib/router/utils/route-regex\");\nvar _router = require(\"./../next-server/lib/router/router\");\nfunction hasRel(rel, link) {\n  try {\n    link = document.createElement('link');\n    return link.relList.supports(rel);\n  } catch (_unused) {}\n}\nvar relPrefetch = hasRel('preload') && !hasRel('prefetch') ?\n// https://caniuse.com/#feat=link-rel-preload\n// macOS and iOS (Safari does not support prefetch)\n'preload' :\n// https://caniuse.com/#feat=link-rel-prefetch\n// IE 11, Edge 12+, nearly all evergreen\n'prefetch';\nvar hasNoModule = ('noModule' in document.createElement('script')); /** @param {string} route */\nfunction normalizeRoute(route) {\n  if (route[0] !== '/') {\n    throw new Error(\"Route name should start with a \\\"/\\\", got \\\"\".concat(route, \"\\\"\"));\n  }\n  route = route.replace(/\\/index$/, '/');\n  if (route === '/') return route;\n  return route.replace(/\\/$/, '');\n}\nfunction appendLink(href, rel, as) {\n  return new Promise(function (res, rej, link) {\n    link = document.createElement('link');\n    link.crossOrigin = process.crossOrigin;\n    link.href = href;\n    link.rel = rel;\n    if (as) link.as = as;\n    link.onload = res;\n    link.onerror = rej;\n    document.head.appendChild(link);\n  });\n}\nvar PageLoader = /*#__PURE__*/function () {\n  function PageLoader(buildId, assetPrefix) {\n    _classCallCheck(this, PageLoader);\n    this.buildId = buildId;\n    this.assetPrefix = assetPrefix;\n    this.pageCache = {};\n    this.pageRegisterEvents = (0, _mitt[\"default\"])();\n    this.loadingRoutes = {};\n    if (process.env.__NEXT_GRANULAR_CHUNKS) {\n      this.promisedBuildManifest = new Promise(function (resolve) {\n        if (window.__BUILD_MANIFEST) {\n          resolve(window.__BUILD_MANIFEST);\n        } else {\n          window.__BUILD_MANIFEST_CB = function () {\n            resolve(window.__BUILD_MANIFEST);\n          };\n        }\n      });\n    } /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise(function (resolve) {\n      if (window.__SSG_MANIFEST) {\n        resolve(window.__SSG_MANIFEST);\n      } else {\n        window.__SSG_MANIFEST_CB = function () {\n          resolve(window.__SSG_MANIFEST);\n        };\n      }\n    });\n  } // Returns a promise for the dependencies for a particular route\n  return _createClass(PageLoader, [{\n    key: \"getDependencies\",\n    value: function getDependencies(route) {\n      var _this = this;\n      return this.promisedBuildManifest.then(function (man) {\n        return man[route] && man[route].map(function (url) {\n          return \"\".concat(_this.assetPrefix, \"/_next/\").concat(encodeURI(url));\n        }) || [];\n      });\n    } /**\n      * @param {string} href the route href (file-system path)\n      * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n      */\n  }, {\n    key: \"getDataHref\",\n    value: function getDataHref(href, asPath) {\n      var _this2 = this;\n      var getHrefForSlug = /** @type string */function getHrefForSlug(path) {\n        path = (0, _router.delBasePath)(path);\n        return \"\".concat(_this2.assetPrefix, \"/_next/data/\").concat(_this2.buildId).concat(path === '/' ? '/index' : path, \".json\");\n      };\n      var _ref = (0, _url.parse)(href, true),\n        hrefPathname = _ref.pathname,\n        query = _ref.query;\n      var _ref2 = (0, _url.parse)(asPath),\n        asPathname = _ref2.pathname;\n      var route = normalizeRoute(hrefPathname);\n      var isDynamic = (0, _isDynamic.isDynamicRoute)(route),\n        interpolatedRoute;\n      if (isDynamic) {\n        var dynamicRegex = (0, _routeRegex.getRouteRegex)(route);\n        var dynamicGroups = dynamicRegex.groups;\n        var dynamicMatches =\n        // Try to match the dynamic route against the asPath\n        (0, _routeMatcher.getRouteMatcher)(dynamicRegex)(asPathname) ||\n        // Fall back to reading the values from the href\n        // TODO: should this take priority; also need to change in the router.\n        query;\n        interpolatedRoute = route;\n        if (!Object.keys(dynamicGroups).every(function (param) {\n          var value = dynamicMatches[param];\n          var repeat = dynamicGroups[param].repeat; // support single-level catch-all\n          // TODO: more robust handling for user-error (passing `/`)\n          if (repeat && !Array.isArray(value)) value = [value];\n          return param in dynamicMatches && (\n          // Interpolate group into data URL if present\n          interpolatedRoute = interpolatedRoute.replace(\"[\".concat(repeat ? '...' : '').concat(param, \"]\"), repeat ? value.map(encodeURIComponent).join('/') : encodeURIComponent(value)));\n        })) {\n          interpolatedRoute = ''; // did not satisfy all requirements\n          // n.b. We ignore this error because we handle warning for this case in\n          // development in the `<Link>` component directly.\n        }\n      }\n      return isDynamic ? interpolatedRoute && getHrefForSlug(interpolatedRoute) : getHrefForSlug(route);\n    } /**\n      * @param {string} href the route href (file-system path)\n      * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n      */\n  }, {\n    key: \"prefetchData\",\n    value: function prefetchData(href, asPath) {\n      var _this3 = this;\n      var _ref3 = (0, _url.parse)(href, true),\n        hrefPathname = _ref3.pathname;\n      var route = normalizeRoute(hrefPathname);\n      return this.promisedSsgManifest.then(function (s, _dataHref) {\n        return (\n          // Check if the route requires a data file\n          s.has(route) && (\n          // Try to generate data href, noop when falsy\n          _dataHref = _this3.getDataHref(href, asPath)) &&\n          // noop when data has already been prefetched (dedupe)\n          !document.querySelector(\"link[rel=\\\"\".concat(relPrefetch, \"\\\"][href^=\\\"\").concat(_dataHref, \"\\\"]\")) &&\n          // Inject the `<link rel=prefetch>` tag for above computed `href`.\n          appendLink(_dataHref, relPrefetch, 'fetch')\n        );\n      });\n    }\n  }, {\n    key: \"loadPage\",\n    value: function loadPage(route) {\n      return this.loadPageScript(route);\n    }\n  }, {\n    key: \"loadPageScript\",\n    value: function loadPageScript(route) {\n      var _this4 = this;\n      route = normalizeRoute(route);\n      return new Promise(function (resolve, reject) {\n        var fire = function fire(_ref4) {\n          var error = _ref4.error,\n            page = _ref4.page,\n            mod = _ref4.mod;\n          _this4.pageRegisterEvents.off(route, fire);\n          delete _this4.loadingRoutes[route];\n          if (error) {\n            reject(error);\n          } else {\n            resolve({\n              page: page,\n              mod: mod\n            });\n          }\n        }; // If there's a cached version of the page, let's use it.\n        var cachedPage = _this4.pageCache[route];\n        if (cachedPage) {\n          var error = cachedPage.error,\n            page = cachedPage.page,\n            mod = cachedPage.mod;\n          error ? reject(error) : resolve({\n            page: page,\n            mod: mod\n          });\n          return;\n        } // Register a listener to get the page\n        _this4.pageRegisterEvents.on(route, fire); // If the page is loading via SSR, we need to wait for it\n        // rather downloading it again.\n        if (document.querySelector(\"script[data-next-page=\\\"\".concat(route, \"\\\"]\"))) {\n          return;\n        }\n        if (!_this4.loadingRoutes[route]) {\n          _this4.loadingRoutes[route] = true;\n          if (process.env.__NEXT_GRANULAR_CHUNKS) {\n            _this4.getDependencies(route).then(function (deps) {\n              deps.forEach(function (d) {\n                if (/\\.js$/.test(d) && !document.querySelector(\"script[src^=\\\"\".concat(d, \"\\\"]\"))) {\n                  _this4.loadScript(d, route, false);\n                }\n                if (/\\.css$/.test(d) && !document.querySelector(\"link[rel=stylesheet][href^=\\\"\".concat(d, \"\\\"]\"))) {\n                  appendLink(d, 'stylesheet')[\"catch\"](function () {// FIXME: handle failure\n                    // Right now, this is needed to prevent an unhandled rejection.\n                  });\n                }\n              });\n              _this4.loadRoute(route);\n            });\n          } else {\n            _this4.loadRoute(route);\n          }\n        }\n      });\n    }\n  }, {\n    key: \"loadRoute\",\n    value: function loadRoute(route) {\n      route = normalizeRoute(route);\n      var scriptRoute = route === '/' ? '/index.js' : \"\".concat(route, \".js\");\n      var url = \"\".concat(this.assetPrefix, \"/_next/static/\").concat(encodeURIComponent(this.buildId), \"/pages\").concat(encodeURI(scriptRoute));\n      this.loadScript(url, route, true);\n    }\n  }, {\n    key: \"loadScript\",\n    value: function loadScript(url, route, isPage) {\n      var _this5 = this;\n      var script = document.createElement('script');\n      if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n        script.type = 'module'; // Only page bundle scripts need to have .module added to url,\n        // dependencies already have it added during build manifest creation\n        if (isPage) url = url.replace(/\\.js$/, '.module.js');\n      }\n      script.crossOrigin = process.crossOrigin;\n      script.src = url;\n      script.onerror = function () {\n        var error = new Error(\"Error loading script \".concat(url));\n        error.code = 'PAGE_LOAD_ERROR';\n        _this5.pageRegisterEvents.emit(route, {\n          error: error\n        });\n      };\n      document.body.appendChild(script);\n    } // This method if called by the route code.\n  }, {\n    key: \"registerPage\",\n    value: function registerPage(route, regFn) {\n      var _this6 = this;\n      var register = function register() {\n        try {\n          var mod = regFn();\n          var pageData = {\n            page: mod[\"default\"] || mod,\n            mod: mod\n          };\n          _this6.pageCache[route] = pageData;\n          _this6.pageRegisterEvents.emit(route, pageData);\n        } catch (error) {\n          _this6.pageCache[route] = {\n            error: error\n          };\n          _this6.pageRegisterEvents.emit(route, {\n            error: error\n          });\n        }\n      };\n      if (true) {\n        // Wait for webpack to become idle if it's not.\n        // More info: https://github.com/vercel/next.js/pull/1511\n        if (module.hot && module.hot.status() !== 'idle') {\n          console.log(\"Waiting for webpack to become \\\"idle\\\" to initialize the page: \\\"\".concat(route, \"\\\"\"));\n          var check = function check(status) {\n            if (status === 'idle') {\n              module.hot.removeStatusHandler(check);\n              register();\n            }\n          };\n          module.hot.status(check);\n          return;\n        }\n      }\n      register();\n    } /**\n      * @param {string} route\n      * @param {boolean} [isDependency]\n      */\n  }, {\n    key: \"prefetch\",\n    value: function prefetch(route, isDependency) {\n      var _this7 = this;\n      // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n      // License: Apache 2.0\n      var cn;\n      if (cn = navigator.connection) {\n        // Don't prefetch if using 2G or if Save-Data is enabled.\n        if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve();\n      } /** @type {string} */\n      var url;\n      if (isDependency) {\n        url = route;\n      } else {\n        route = normalizeRoute(route);\n        var scriptRoute = \"\".concat(route === '/' ? '/index' : route, \".js\");\n        if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n          scriptRoute = scriptRoute.replace(/\\.js$/, '.module.js');\n        }\n        url = \"\".concat(this.assetPrefix, \"/_next/static/\").concat(encodeURIComponent(this.buildId), \"/pages\").concat(encodeURI(scriptRoute));\n      }\n      return Promise.all(document.querySelector(\"link[rel=\\\"\".concat(relPrefetch, \"\\\"][href^=\\\"\").concat(url, \"\\\"], script[data-next-page=\\\"\").concat(route, \"\\\"]\")) ? [] : [appendLink(url, relPrefetch, url.match(/\\.css$/) ? 'style' : 'script'), process.env.__NEXT_GRANULAR_CHUNKS && !isDependency && this.getDependencies(route).then(function (urls) {\n        return Promise.all(urls.map(function (url) {\n          return _this7.prefetch(url, true);\n        }));\n      })]).then(\n      // do not return any data\n      function () {},\n      // swallow prefetch errors\n      function () {});\n    }\n  }]);\n}();\nexports[\"default\"] = PageLoader;","map":{"version":3,"sources":["../../client/page-loader.js"],"names":["hasRel","rel","link","document","createElement","relList","supports","relPrefetch","hasNoModule","normalizeRoute","route","Error","replace","appendLink","href","as","Promise","res","rej","crossOrigin","process","onload","onerror","head","appendChild","PageLoader","constructor","buildId","assetPrefix","pageCache","pageRegisterEvents","loadingRoutes","env","__NEXT_GRANULAR_CHUNKS","promisedBuildManifest","resolve","window","__BUILD_MANIFEST","__BUILD_MANIFEST_CB","promisedSsgManifest","__SSG_MANIFEST","__SSG_MANIFEST_CB","getDependencies","then","man","map","url","encodeURI","getDataHref","asPath","getHrefForSlug","path","pathname","hrefPathname","query","asPathname","isDynamic","interpolatedRoute","dynamicRegex","dynamicGroups","groups","dynamicMatches","Object","keys","every","param","value","repeat","Array","isArray","encodeURIComponent","join","prefetchData","s","_dataHref","has","querySelector","loadPage","loadPageScript","reject","fire","error","page","mod","off","cachedPage","on","deps","forEach","d","test","loadScript","loadRoute","scriptRoute","isPage","script","__NEXT_MODERN_BUILD","type","src","code","emit","body","registerPage","regFn","register","pageData","module","hot","status","console","log","check","removeStatusHandler","prefetch","isDependency","cn","navigator","connection","saveData","effectiveType","all","match","urls"],"mappings":"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","sourcesContent":["import { parse } from 'url'\nimport mitt from '../next-server/lib/mitt'\nimport { isDynamicRoute } from './../next-server/lib/router/utils/is-dynamic'\nimport { getRouteMatcher } from './../next-server/lib/router/utils/route-matcher'\nimport { getRouteRegex } from './../next-server/lib/router/utils/route-regex'\nimport { delBasePath } from './../next-server/lib/router/router'\n\nfunction hasRel(rel, link) {\n  try {\n    link = document.createElement('link')\n    return link.relList.supports(rel)\n  } catch {}\n}\n\nconst relPrefetch =\n  hasRel('preload') && !hasRel('prefetch')\n    ? // https://caniuse.com/#feat=link-rel-preload\n      // macOS and iOS (Safari does not support prefetch)\n      'preload'\n    : // https://caniuse.com/#feat=link-rel-prefetch\n      // IE 11, Edge 12+, nearly all evergreen\n      'prefetch'\n\nconst hasNoModule = 'noModule' in document.createElement('script')\n\n/** @param {string} route */\nfunction normalizeRoute(route) {\n  if (route[0] !== '/') {\n    throw new Error(`Route name should start with a \"/\", got \"${route}\"`)\n  }\n  route = route.replace(/\\/index$/, '/')\n\n  if (route === '/') return route\n  return route.replace(/\\/$/, '')\n}\n\nfunction appendLink(href, rel, as) {\n  return new Promise((res, rej, link) => {\n    link = document.createElement('link')\n    link.crossOrigin = process.crossOrigin\n    link.href = href\n    link.rel = rel\n    if (as) link.as = as\n\n    link.onload = res\n    link.onerror = rej\n\n    document.head.appendChild(link)\n  })\n}\n\nexport default class PageLoader {\n  constructor(buildId, assetPrefix) {\n    this.buildId = buildId\n    this.assetPrefix = assetPrefix\n\n    this.pageCache = {}\n    this.pageRegisterEvents = mitt()\n    this.loadingRoutes = {}\n    if (process.env.__NEXT_GRANULAR_CHUNKS) {\n      this.promisedBuildManifest = new Promise((resolve) => {\n        if (window.__BUILD_MANIFEST) {\n          resolve(window.__BUILD_MANIFEST)\n        } else {\n          window.__BUILD_MANIFEST_CB = () => {\n            resolve(window.__BUILD_MANIFEST)\n          }\n        }\n      })\n    }\n    /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise((resolve) => {\n      if (window.__SSG_MANIFEST) {\n        resolve(window.__SSG_MANIFEST)\n      } else {\n        window.__SSG_MANIFEST_CB = () => {\n          resolve(window.__SSG_MANIFEST)\n        }\n      }\n    })\n  }\n\n  // Returns a promise for the dependencies for a particular route\n  getDependencies(route) {\n    return this.promisedBuildManifest.then(\n      (man) =>\n        (man[route] &&\n          man[route].map(\n            (url) => `${this.assetPrefix}/_next/${encodeURI(url)}`\n          )) ||\n        []\n    )\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  getDataHref(href, asPath) {\n    const getHrefForSlug = (/** @type string */ path) => {\n      path = delBasePath(path)\n      return `${this.assetPrefix}/_next/data/${this.buildId}${\n        path === '/' ? '/index' : path\n      }.json`\n    }\n\n    const { pathname: hrefPathname, query } = parse(href, true)\n    const { pathname: asPathname } = parse(asPath)\n\n    const route = normalizeRoute(hrefPathname)\n\n    let isDynamic = isDynamicRoute(route),\n      interpolatedRoute\n    if (isDynamic) {\n      const dynamicRegex = getRouteRegex(route)\n      const dynamicGroups = dynamicRegex.groups\n      const dynamicMatches =\n        // Try to match the dynamic route against the asPath\n        getRouteMatcher(dynamicRegex)(asPathname) ||\n        // Fall back to reading the values from the href\n        // TODO: should this take priority; also need to change in the router.\n        query\n\n      interpolatedRoute = route\n      if (\n        !Object.keys(dynamicGroups).every((param) => {\n          let value = dynamicMatches[param]\n          const repeat = dynamicGroups[param].repeat\n\n          // support single-level catch-all\n          // TODO: more robust handling for user-error (passing `/`)\n          if (repeat && !Array.isArray(value)) value = [value]\n\n          return (\n            param in dynamicMatches &&\n            // Interpolate group into data URL if present\n            (interpolatedRoute = interpolatedRoute.replace(\n              `[${repeat ? '...' : ''}${param}]`,\n              repeat\n                ? value.map(encodeURIComponent).join('/')\n                : encodeURIComponent(value)\n            ))\n          )\n        })\n      ) {\n        interpolatedRoute = '' // did not satisfy all requirements\n\n        // n.b. We ignore this error because we handle warning for this case in\n        // development in the `<Link>` component directly.\n      }\n    }\n\n    return isDynamic\n      ? interpolatedRoute && getHrefForSlug(interpolatedRoute)\n      : getHrefForSlug(route)\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  prefetchData(href, asPath) {\n    const { pathname: hrefPathname } = parse(href, true)\n    const route = normalizeRoute(hrefPathname)\n    return this.promisedSsgManifest.then(\n      (s, _dataHref) =>\n        // Check if the route requires a data file\n        s.has(route) &&\n        // Try to generate data href, noop when falsy\n        (_dataHref = this.getDataHref(href, asPath)) &&\n        // noop when data has already been prefetched (dedupe)\n        !document.querySelector(\n          `link[rel=\"${relPrefetch}\"][href^=\"${_dataHref}\"]`\n        ) &&\n        // Inject the `<link rel=prefetch>` tag for above computed `href`.\n        appendLink(_dataHref, relPrefetch, 'fetch')\n    )\n  }\n\n  loadPage(route) {\n    return this.loadPageScript(route)\n  }\n\n  loadPageScript(route) {\n    route = normalizeRoute(route)\n\n    return new Promise((resolve, reject) => {\n      const fire = ({ error, page, mod }) => {\n        this.pageRegisterEvents.off(route, fire)\n        delete this.loadingRoutes[route]\n\n        if (error) {\n          reject(error)\n        } else {\n          resolve({ page, mod })\n        }\n      }\n\n      // If there's a cached version of the page, let's use it.\n      const cachedPage = this.pageCache[route]\n      if (cachedPage) {\n        const { error, page, mod } = cachedPage\n        error ? reject(error) : resolve({ page, mod })\n        return\n      }\n\n      // Register a listener to get the page\n      this.pageRegisterEvents.on(route, fire)\n\n      // If the page is loading via SSR, we need to wait for it\n      // rather downloading it again.\n      if (document.querySelector(`script[data-next-page=\"${route}\"]`)) {\n        return\n      }\n\n      if (!this.loadingRoutes[route]) {\n        this.loadingRoutes[route] = true\n        if (process.env.__NEXT_GRANULAR_CHUNKS) {\n          this.getDependencies(route).then((deps) => {\n            deps.forEach((d) => {\n              if (\n                /\\.js$/.test(d) &&\n                !document.querySelector(`script[src^=\"${d}\"]`)\n              ) {\n                this.loadScript(d, route, false)\n              }\n              if (\n                /\\.css$/.test(d) &&\n                !document.querySelector(`link[rel=stylesheet][href^=\"${d}\"]`)\n              ) {\n                appendLink(d, 'stylesheet').catch(() => {\n                  // FIXME: handle failure\n                  // Right now, this is needed to prevent an unhandled rejection.\n                })\n              }\n            })\n            this.loadRoute(route)\n          })\n        } else {\n          this.loadRoute(route)\n        }\n      }\n    })\n  }\n\n  loadRoute(route) {\n    route = normalizeRoute(route)\n    let scriptRoute = route === '/' ? '/index.js' : `${route}.js`\n\n    const url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n      this.buildId\n    )}/pages${encodeURI(scriptRoute)}`\n    this.loadScript(url, route, true)\n  }\n\n  loadScript(url, route, isPage) {\n    const script = document.createElement('script')\n    if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n      script.type = 'module'\n      // Only page bundle scripts need to have .module added to url,\n      // dependencies already have it added during build manifest creation\n      if (isPage) url = url.replace(/\\.js$/, '.module.js')\n    }\n    script.crossOrigin = process.crossOrigin\n    script.src = url\n    script.onerror = () => {\n      const error = new Error(`Error loading script ${url}`)\n      error.code = 'PAGE_LOAD_ERROR'\n      this.pageRegisterEvents.emit(route, { error })\n    }\n    document.body.appendChild(script)\n  }\n\n  // This method if called by the route code.\n  registerPage(route, regFn) {\n    const register = () => {\n      try {\n        const mod = regFn()\n        const pageData = { page: mod.default || mod, mod }\n        this.pageCache[route] = pageData\n        this.pageRegisterEvents.emit(route, pageData)\n      } catch (error) {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Wait for webpack to become idle if it's not.\n      // More info: https://github.com/vercel/next.js/pull/1511\n      if (module.hot && module.hot.status() !== 'idle') {\n        console.log(\n          `Waiting for webpack to become \"idle\" to initialize the page: \"${route}\"`\n        )\n\n        const check = (status) => {\n          if (status === 'idle') {\n            module.hot.removeStatusHandler(check)\n            register()\n          }\n        }\n        module.hot.status(check)\n        return\n      }\n    }\n\n    register()\n  }\n\n  /**\n   * @param {string} route\n   * @param {boolean} [isDependency]\n   */\n  prefetch(route, isDependency) {\n    // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n    // License: Apache 2.0\n    let cn\n    if ((cn = navigator.connection)) {\n      // Don't prefetch if using 2G or if Save-Data is enabled.\n      if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve()\n    }\n\n    /** @type {string} */\n    let url\n    if (isDependency) {\n      url = route\n    } else {\n      route = normalizeRoute(route)\n\n      let scriptRoute = `${route === '/' ? '/index' : route}.js`\n      if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n        scriptRoute = scriptRoute.replace(/\\.js$/, '.module.js')\n      }\n\n      url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n        this.buildId\n      )}/pages${encodeURI(scriptRoute)}`\n    }\n\n    return Promise.all(\n      document.querySelector(\n        `link[rel=\"${relPrefetch}\"][href^=\"${url}\"], script[data-next-page=\"${route}\"]`\n      )\n        ? []\n        : [\n            appendLink(\n              url,\n              relPrefetch,\n              url.match(/\\.css$/) ? 'style' : 'script'\n            ),\n            process.env.__NEXT_GRANULAR_CHUNKS &&\n              !isDependency &&\n              this.getDependencies(route).then((urls) =>\n                Promise.all(urls.map((url) => this.prefetch(url, true)))\n              ),\n          ]\n    ).then(\n      // do not return any data\n      () => {},\n      // swallow prefetch errors\n      () => {}\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"script"}